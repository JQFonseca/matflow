tasks:
  
  - name: generate_orientations
    outputs:
      - orientations
    methods:
      - name: _default
        implementations:
          - name: mtex
            inputs:
              - num
            input_map:
              - inputs: [num]
                file: get_ori.m
            output_map:
              - files: [ori.txt]
                output: orientations
            commands:
              - cmd: matlab -nodisplay -nosplash -nodesktop -r -wait "run('get_ori.m'); exit;"
  
  - name: generate_rve
    outputs:
      - rve
    methods:
      - name: from_stats
        inputs:
          - grid_size
          - resolution
          - orientations
          - axis_orientation
        implementations:
          - name: dream3d
            input_map:
              - inputs: [grid_size, resolution, orientations, axis_orientation]
                file: pipeline.json
            output_map:
              - files: [synthetic.dream3d]
                output: rve
            commands:
              - cmd: PipelineRunner
                arg_labels:
                  p: _file:pipeline.json

      - name: random_voronoi
        inputs:
          - grid_size
          - num_grains
          - size
        implementations:
          - name: damask
            outputs:
              - _file:rve.geom
            output_map:
              - files: [rve.geom]
                output: rve
            commands:
              - cmd: seeds_fromRandom
                stdout: orientation.seeds
                arg_labels: 
                  N: num_grains
                  g: grid_size
              - cmd: geom_fromVoronoiTessellation
                stdin: orientation.seeds
                stdout: rve.geom
                arg_labels:
                  s: size
              # - cmd: geom_check rve.geom

  - name: generate_load_case
    outputs:
      - load_case
    methods:
      - name: random_3d
      - name: random_2d
        inputs:
          - loading_plane
      - name: tension_x

  - name: simulate_rve_loading
    inputs:
      - material
      - rve
      - load_case
    outputs:
      - rve_response
    methods:
      - name: FFT
        implementations:
          - name: damask
            input_map:
              - inputs: [material, rve]
                file: material.config
              - inputs: [load_case]
                file: load.load
              - inputs: [rve]
                file: geom.geom
            output_map:
              - files: [geom_load.txt]
                output: rve_response
            commands:
              - cmd: echo "hi"
              # - cmd: geom_check geom.geom
              # - cmd: DAMASK_spectral
              #   arg_labels: 
              #     l: _file:load.load
              #     g: _file:geom.geom
              # - cmd: postResults --dir . --cr "f,p" --co "totalshear" geom_load.spectralOut
              # - cmd: addCauchy geom_load.txt
              # - cmd: addStrainTensors --logarithmic --left geom_load.txt
              # - cmd: addMises --stress "Cauchy" --strain "ln(V)" geom_load.txt

  - name: fit_yield_criterion
    inputs:
      - yield_criterion    
      - yield_stress
    outputs:    
      - fit_tol
    methods:
      - name: von_mises
